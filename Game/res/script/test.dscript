

laserEnemy(_cx - 100);
wait 10;
laserEnemy(_cx);
wait 10;
laserEnemy(_cx + 100);

task laserEnemy(x){
    
    set c = 6;
    
    set e = enemy(x, _ty - 32, 500);
    e.setDir(90);
    
    e.setSpd(7);
    e.setMinSpd(0);
    e.setAccel(-0.2);
    
    wait 60;
    
    set dir = rand(0, 360);
    set inv = false;
    
    while(!e.isDeleted()){
        for(d in 0, 360/c, 360){
            laser(dir + d);
        }
        
        dir += rand(15, 30);
        inv!!;
        
        wait 30;
    }
    
    task laser(d2){
        
        set r = 50;
        set angvel = 0.1;
        set col = _red;
        
        if(inv){
            col = _purple;
            angvel!!;
        }
        
        set l = laser(_laser, col, e.getPos(), d2, 500, 16, 45);
        l.setAdditive();
        
        for(d in 0, 360/c, 360){
            bullet(_orb, col, e.getPos(), d2 +  d, 2, -15);
        }
        
        set ct = 0;
        
        for(i in 60){
            
            l.setX(e.getX() + r*cos(d2));
            l.setY(e.getY() + r*sin(d2));
            l.setDir(d2);
            
            d2 += angvel;
            
            if(e.isDeleted()){
                break;
            }
            
            wait;
        }
        
        l.delete();
    }
}